#INFO: **** input file is /share/home/srwang/ExSCF/examples/40-DDFT.py ****
from pyscf import lib
from pyphf import suscf, guess, supdft

xyz = '''N 0.0 0.0 0.0; N 0.0 0.0 2.0'''
bas = 'cc-pvdz'

lib.num_threads(8)

mf = guess.from_frag(xyz, bas, [[0],[1]], [0,0], [3,-3])
mf2 = suscf.SUHF(mf)
mf2.do2pdm = True
mf2.kernel()

mf3 = supdft.PDFT(mf2, 'tpbe')
mf3.dens = 'pd'
mf3.kernel()

mf4 = supdft.PDFT(mf2, 'pbe')
mf4.dens = 'dd'
mf4.kernel()

#INFO: ******************** input file end ********************


System: uname_result(system='Linux', node='xn01', release='3.10.0-1127.el7.x86_64', version='#1 SMP Tue Feb 18 16:39:12 EST 2020', machine='x86_64', processor='x86_64')  Threads 8
Python 3.7.4 (default, Aug 13 2019, 20:35:49) 
[GCC 7.3.0]
numpy 1.17.2  scipy 1.4.1
Date: Fri Jan 21 22:12:43 2022
PySCF version 1.7.6a1
PySCF path  /share/home/srwang/pyscf/pyscf
GIT ORIG_HEAD 80f71dfe77ac5f9caae26788acf76446987635bd
GIT HEAD      ref: refs/heads/master
GIT master branch  80f71dfe77ac5f9caae26788acf76446987635bd

[ENV] PYSCF_EXT_PATH /share/home/srwang/dh:/share/home/srwang/pyscf_ext/dftd3:/share/home/srwang/pyscf_ext/fciqmc:
[CONFIG] conf_file /share/home/srwang/.pyscf_conf.py
[INPUT] verbose = 4
[INPUT] num. atoms = 2
[INPUT] num. electrons = 14
[INPUT] charge = 0
[INPUT] spin (= nelec alpha-beta = 2S) = 0
[INPUT] symmetry False subgroup None
[INPUT] Mole.unit = angstrom
[INPUT]  1 N      0.000000000000   0.000000000000   0.000000000000 AA    0.000000000000   0.000000000000   0.000000000000 Bohr
[INPUT]  2 N      0.000000000000   0.000000000000   2.000000000000 AA    0.000000000000   0.000000000000   3.779452249130 Bohr

nuclear repulsion = 12.96484166754
number of shells = 10
number of NR pGTOs = 52
number of NR cGTOs = 28
basis = cc-pvdz
ecp = {}
CPU time:         1.11
**** generating fragment guess ****
fragments: [('N', [0.0, 0.0, 0.0])] [('N', [0.0, 0.0, 2.0])]
converged SCF energy = -54.3911145621998  <S^2> = 3.7540306  2S+1 = 4.0020148
converged SCF energy = -54.3911145621998  <S^2> = 3.7540306  2S+1 = 4.0020148
       na   nb
atom1   5    2
atom2   2    5


******** <class 'pyscf.scf.uhf.UHF'> ********
method = UHF
initial guess = minao
damping factor = 0
level_shift factor = 0
DIIS = <class 'pyscf.scf.diis.CDIIS'>
diis_start_cycle = 1
diis_space = 8
SCF conv_tol = 1e-09
SCF conv_tol_grad = None
SCF max_cycles = 2
direct_scf = True
direct_scf_tol = 1e-13
chkfile to save SCF result = /share/home/srwang/ExSCF/examples/tmpbzo3g2be
max_memory 4000 MB (current use 131 MB)
number electrons alpha = 7  beta = 7
Set gradient conv threshold to 3.16228e-05
init E= -108.865025650226
  alpha nocc = 7  HOMO = -0.496864103772384  LUMO = 0.166656211058822
  beta  nocc = 7  HOMO = -0.496864103772393  LUMO = 0.166656211058823
cycle= 1 E= -108.766710283023  delta_E= 0.0983  |g|= 0.0389  |ddm|= 0.311
  alpha nocc = 7  HOMO = -0.537250995512784  LUMO = 0.163735138487362
  beta  nocc = 7  HOMO = -0.53725099551279  LUMO = 0.163735138487358
cycle= 2 E= -108.768525746498  delta_E= -0.00182  |g|= 0.018  |ddm|= 0.0417
SCF not converged.
SCF energy = -108.768525746498 after 2 cycles  <S^2> = 2.8016899  2S+1 = 3.4938174
time for guess: 0.193

******** <class 'pyphf.suscf.SUHF'> ********
Date: Fri Jan 21 22:12:43 2022
pyphf version 0.4.2
pyphf path  /share/home/srwang/ExSCF
GIT ORIG_HEAD bb1329eebee542cdd3a9542e0142eb99a0cc8615
GIT HEAD (branch dev) f989b1a0cfcb7c0e359347f630e194bf0377f726
max_cycle: 70
verbose: 4                # normal
conv_tol: 1e-07           # 1e-07 for RMSD(dm), 1e-05 for MaxD(dm), 1e-09 for dE
DIIS: <class 'pyscf.scf.diis.CDIIS'>
diis_start_cyc = 10
grids:  [0.06237655 0.31939555 0.74529195 1.28265786 1.85893479 2.39630071
 2.8221971  3.07921611] 
weights:  [0.15900941 0.34931531 0.49276925 0.56970235 0.56970235 0.49276925
 0.34931531 0.15900941]
S = 0.0, Sz = 0.0
>Wigner small d:  1
>value : [1. 1. 1. 1. 1. 1. 1. 1.]
time for Preparation before cyc: 0.083
**** Start Cycle 1 ****
time for NO, Ng: 0.025
time for Gg: 0.083
detC 1.0000000000000036
detNg [    1.002729     1.074331     1.486613     3.392194    15.774216   164.554017  2955.550795 17634.79206 ]
xg [0.997278 0.930812 0.67267  0.294794 0.063395 0.006077 0.000338 0.000057]
ciS 0.5344951257839985
ciH -65.07443089707309
Hsp + Hph =  -121.74934392829454
S2 = -0.000000
Alpha occ 7 vir 21; Beta occ 7 vir 21
Alpha energies:  [-15.583829  -1.16824   -0.760255  -0.567018  -0.567018  -0.536545] <- HOMO
         LUMO->  [0.162047 0.162047 0.21217  0.88394  0.88394  0.908477]
Beta energies:   [-15.583829  -1.16824   -0.760255  -0.567018  -0.567018  -0.536545] <- HOMO
         LUMO->  [0.162047 0.162047 0.21217  0.88394  0.88394  0.908477]
time for xg, H, S2, Yg, Feff: 0.020
 E =   -108.78450226
**** Start Cycle 2 ****
time for NO, Ng: 0.024
time for Gg: 0.082
detC -0.9999999999999992
detNg [    1.002717     1.073984     1.483765     3.368459    15.443515   155.174574  2518.773923 12967.473615]
xg [0.99729  0.931112 0.673961 0.296872 0.064752 0.006444 0.000397 0.000077]
ciS 0.5369652525982331
ciH -65.37606298601955
Hsp + Hph =  -121.75101213659921
S2 = -0.000000
Alpha occ 7 vir 21; Beta occ 7 vir 21
Alpha energies:  [-15.584666  -1.171019  -0.759312  -0.56827   -0.56827   -0.536455] <- HOMO
         LUMO->  [0.161273 0.161273 0.210798 0.882985 0.882985 0.909182]
Beta energies:   [-15.584666  -1.171019  -0.759312  -0.56827   -0.56827   -0.536455] <- HOMO
         LUMO->  [0.161273 0.161273 0.210798 0.882985 0.882985 0.909182]
time for xg, H, S2, Yg, Feff: 0.019
 E =   -108.78617047, delta E = -0.00166821, MaxD(dm) = 0.00576182, RMSD(dm) = 0.000620307
**** Start Cycle 3 ****
time for NO, Ng: 0.024
time for Gg: 0.083
detC 0.9999999999999979
detNg [    1.002713     1.073856     1.482698     3.359414    15.318796   151.994234  2409.489091 12097.336845]
xg [0.997295 0.931223 0.674446 0.297671 0.065279 0.006579 0.000415 0.000083]
ciS 0.5379111953448523
ciH -65.49155405476718
Hsp + Hph =  -121.7516099711977
S2 = -0.000000
Alpha occ 7 vir 21; Beta occ 7 vir 21
Alpha energies:  [-15.583354  -1.172042  -0.757859  -0.568795  -0.568795  -0.536113] <- HOMO
         LUMO->  [0.161393 0.161393 0.210529 0.882686 0.882686 0.910039]
Beta energies:   [-15.583354  -1.172042  -0.757859  -0.568795  -0.568795  -0.536113] <- HOMO
         LUMO->  [0.161393 0.161393 0.210529 0.882686 0.882686 0.910039]
time for xg, H, S2, Yg, Feff: 0.020
 E =   -108.78676830, delta E = -0.000597835, MaxD(dm) = 0.00366287, RMSD(dm) = 0.00040216
**** Start Cycle 4 ****
time for NO, Ng: 0.024
time for Gg: 0.083
detC -0.9999999999999954
detNg [    1.00271      1.073786     1.482111     3.354407    15.250251   150.329159  2360.011084 11758.11101 ]
xg [0.997297 0.931284 0.674713 0.298115 0.065573 0.006652 0.000424 0.000085]
ciS 0.5384354832139956
ciH -65.55552083665111
Hsp + Hph =  -121.75185863558096
S2 = -0.000000
Alpha occ 7 vir 21; Beta occ 7 vir 21
Alpha energies:  [-15.582903  -1.172799  -0.756996  -0.569329  -0.569329  -0.536062] <- HOMO
         LUMO->  [0.161364 0.161364 0.210203 0.88236  0.88236  0.910567]
Beta energies:   [-15.582903  -1.172799  -0.756996  -0.569329  -0.569329  -0.536062] <- HOMO
         LUMO->  [0.161364 0.161364 0.210203 0.88236  0.88236  0.910567]
time for xg, H, S2, Yg, Feff: 0.020
 E =   -108.78701697, delta E = -0.000248664, MaxD(dm) = 0.00241643, RMSD(dm) = 0.000264754
**** Start Cycle 5 ****
time for NO, Ng: 0.024
time for Gg: 0.082
detC 1.0000000000000067
detNg [    1.002709     1.073741     1.481736     3.35123     15.207251   149.312628  2331.79097  11578.795847]
xg [0.997299 0.931323 0.674884 0.298398 0.065758 0.006697 0.000429 0.000086]
ciS 0.5387681481825841
ciH -65.59608089317769
Hsp + Hph =  -121.7519653202433
S2 = -0.000000
Alpha occ 7 vir 21; Beta occ 7 vir 21
Alpha energies:  [-15.582601  -1.173272  -0.756428  -0.569694  -0.569694  -0.536028] <- HOMO
         LUMO->  [0.161352 0.161352 0.209981 0.882138 0.882138 0.910946]
Beta energies:   [-15.582601  -1.173272  -0.756428  -0.569694  -0.569694  -0.536028] <- HOMO
         LUMO->  [0.161352 0.161352 0.209981 0.882138 0.882138 0.910946]
time for xg, H, S2, Yg, Feff: 0.019
 E =   -108.78712365, delta E = -0.000106685, MaxD(dm) = 0.00162029, RMSD(dm) = 0.000175713
**** Start Cycle 6 ****
time for NO, Ng: 0.024
time for Gg: 0.082
detC -1.0
detNg [    1.002708     1.07371      1.48148      3.349084    15.178601   148.647242  2313.87047  11468.488516]
xg [0.9973   0.93135  0.675001 0.298589 0.065882 0.006727 0.000432 0.000087]
ciS 0.5389926009145449
ciH -65.62343350825617
Hsp + Hph =  -121.75201180296074
S2 = -0.000000
Alpha occ 7 vir 21; Beta occ 7 vir 21
Alpha energies:  [-15.582433  -1.173582  -0.756072  -0.569947  -0.569947  -0.536009] <- HOMO
         LUMO->  [0.161336 0.161336 0.209818 0.881982 0.881982 0.91121 ]
Beta energies:   [-15.582433  -1.173582  -0.756072  -0.569947  -0.569947  -0.536009] <- HOMO
         LUMO->  [0.161336 0.161336 0.209818 0.881982 0.881982 0.91121 ]
time for xg, H, S2, Yg, Feff: 0.019
 E =   -108.78717014, delta E = -4.64827e-05, MaxD(dm) = 0.00109408, RMSD(dm) = 0.000117179
**** Start Cycle 7 ****
time for NO, Ng: 0.028
time for Gg: 0.083
detC -1.0000000000000036
detNg [    1.002707     1.073689     1.481301     3.347598    15.159027   148.198645  2301.967668 11396.141986]
xg [0.9973   0.931369 0.675082 0.298722 0.065967 0.006748 0.000434 0.000088]
ciS 0.5391478302680054
ciH -65.64234403774937
Hsp + Hph =  -121.75203228605996
S2 = -0.000000
Alpha occ 7 vir 21; Beta occ 7 vir 21
Alpha energies:  [-15.582339  -1.173784  -0.755849  -0.570119  -0.570119  -0.535997] <- HOMO
         LUMO->  [0.161322 0.161322 0.2097   0.881875 0.881875 0.911395]
Beta energies:   [-15.582339  -1.173784  -0.755849  -0.570119  -0.570119  -0.535997] <- HOMO
         LUMO->  [0.161322 0.161322 0.2097   0.881875 0.881875 0.911395]
time for xg, H, S2, Yg, Feff: 0.021
 E =   -108.78719062, delta E = -2.04831e-05, MaxD(dm) = 0.000741428, RMSD(dm) = 7.84444e-05
**** Start Cycle 8 ****
time for NO, Ng: 0.024
time for Gg: 0.084
detC -1.0000000000000007
detNg [    1.002706     1.073673     1.481175     3.346561    15.145524   147.892491  2293.914149 11347.449414]
xg [0.997301 0.931382 0.67514  0.298814 0.066026 0.006762 0.000436 0.000088]
ciS 0.5392560797650694
ciH -65.65552854682512
Hsp + Hph =  -121.75204139641487
S2 = -0.000000
Alpha occ 7 vir 21; Beta occ 7 vir 21
Alpha energies:  [-15.58229   -1.173917  -0.755711  -0.570235  -0.570235  -0.535989] <- HOMO
         LUMO->  [0.161311 0.161311 0.209616 0.881802 0.881802 0.911524]
Beta energies:   [-15.58229   -1.173917  -0.755711  -0.570235  -0.570235  -0.535989] <- HOMO
         LUMO->  [0.161311 0.161311 0.209616 0.881802 0.881802 0.911524]
time for xg, H, S2, Yg, Feff: 0.019
 E =   -108.78719973, delta E = -9.11035e-06, MaxD(dm) = 0.000503434, RMSD(dm) = 5.26769e-05
**** Start Cycle 9 ****
time for NO, Ng: 0.024
time for Gg: 0.081
detC 1.0000000000000024
detNg [    1.002706     1.073663     1.481086     3.345835    15.136184   147.682587  2288.424351 11314.339991]
xg [0.997301 0.931391 0.67518  0.298879 0.066067 0.006771 0.000437 0.000088]
ciS 0.5393316663484871
ciH -65.66473357031782
Hsp + Hph =  -121.75204548046844
S2 = -0.000000
Alpha occ 7 vir 21; Beta occ 7 vir 21
Alpha energies:  [-15.582265  -1.174004  -0.755626  -0.570314  -0.570314  -0.535984] <- HOMO
         LUMO->  [0.161301 0.161301 0.209557 0.881751 0.881751 0.911614]
Beta energies:   [-15.582265  -1.174004  -0.755626  -0.570314  -0.570314  -0.535984] <- HOMO
         LUMO->  [0.161301 0.161301 0.209557 0.881751 0.881751 0.911614]
time for xg, H, S2, Yg, Feff: 0.019
 E =   -108.78720381, delta E = -4.08405e-06, MaxD(dm) = 0.000342239, RMSD(dm) = 3.54654e-05
**** Start Cycle 10 ****
time for NO, Ng: 0.024
time for Gg: 0.082
detC 0.9999999999999997
detNg [    1.002706     1.073655     1.481023     3.345329    15.129723   147.538474  2284.671185 11291.734093]
xg [0.997302 0.931398 0.675209 0.298924 0.066095 0.006778 0.000438 0.000089]
ciS 0.5393843726087846
ciH -65.67115165947854
Hsp + Hph =  -121.75204732360649
S2 = -0.000000
F(mod,ortho) updated with CDIIS
Alpha occ 7 vir 21; Beta occ 7 vir 21
Alpha energies:  [-15.582255  -1.174062  -0.755573  -0.570368  -0.570368  -0.535981] <- HOMO
         LUMO->  [0.161294 0.161294 0.209515 0.881717 0.881717 0.911676]
Beta energies:   [-15.582255  -1.174062  -0.755573  -0.570368  -0.570368  -0.535981] <- HOMO
         LUMO->  [0.161294 0.161294 0.209515 0.881717 0.881717 0.911676]
time for xg, H, S2, Yg, Feff: 0.021
 E =   -108.78720566, delta E = -1.84314e-06, MaxD(dm) = 0.000232837, RMSD(dm) = 2.39299e-05
**** Start Cycle 11 ****
time for NO, Ng: 0.024
time for Gg: 0.082
detC -1.0000000000000029
detNg [    1.002706     1.073649     1.480979     3.344976    15.125259   147.439525  2282.102624 11276.274457]
xg [0.997302 0.931403 0.675229 0.298956 0.066115 0.006782 0.000438 0.000089]
ciS 0.539421042387404
ciH -65.67561673136044
Hsp + Hph =  -121.75204816017023
S2 = -0.000000
F(mod,ortho) updated with CDIIS
Alpha occ 7 vir 21; Beta occ 7 vir 21
Alpha energies:  [-15.582243  -1.174178  -0.755474  -0.570479  -0.570479  -0.535975] <- HOMO
         LUMO->  [0.161277 0.161277 0.209425 0.881645 0.881645 0.911806]
Beta energies:   [-15.582243  -1.174178  -0.755474  -0.570479  -0.570479  -0.535975] <- HOMO
         LUMO->  [0.161277 0.161277 0.209425 0.881645 0.881645 0.911806]
time for xg, H, S2, Yg, Feff: 0.020
 E =   -108.78720649, delta E = -8.36564e-07, MaxD(dm) = 0.000482857, RMSD(dm) = 4.93049e-05
**** Start Cycle 12 ****
time for NO, Ng: 0.024
time for Gg: 0.082
detC 0.9999999999999963
detNg [    1.002705     1.073638     1.480886     3.34423     15.11588    147.232825  2276.753685 11244.099004]
xg [0.997302 0.931413 0.675272 0.299023 0.066156 0.006792 0.000439 0.000089]
ciS 0.5394985766206501
ciH -65.68505706224167
Hsp + Hph =  -121.75204886300988
S2 = -0.000000
F(mod,ortho) updated with CDIIS
Alpha occ 7 vir 21; Beta occ 7 vir 21
Alpha energies:  [-15.582261  -1.174175  -0.755486  -0.570481  -0.570481  -0.535975] <- HOMO
         LUMO->  [0.161274 0.161274 0.209417 0.881642 0.881642 0.911814]
Beta energies:   [-15.582261  -1.174175  -0.755486  -0.570481  -0.570481  -0.535975] <- HOMO
         LUMO->  [0.161274 0.161274 0.209417 0.881642 0.881642 0.911814]
time for xg, H, S2, Yg, Feff: 0.020
 E =   -108.78720720, delta E = -7.0284e-07, MaxD(dm) = 2.28287e-05, RMSD(dm) = 2.29304e-06
**** Start Cycle 13 ****
time for NO, Ng: 0.024
time for Gg: 0.082
detC 0.9999999999999998
detNg [    1.002705     1.073637     1.480879     3.344181    15.115366   147.223149  2276.519624 11242.689176]
xg [0.997302 0.931414 0.675275 0.299027 0.066158 0.006792 0.000439 0.000089]
ciS 0.5395035209349437
ciH -65.68565904400019
Hsp + Hph =  -121.75204886553638
S2 = -0.000000
F(mod,ortho) updated with CDIIS
Alpha occ 7 vir 21; Beta occ 7 vir 21
Alpha energies:  [-15.582262  -1.174176  -0.755488  -0.570481  -0.570481  -0.535976] <- HOMO
         LUMO->  [0.161274 0.161274 0.209418 0.881642 0.881642 0.911814]
Beta energies:   [-15.582262  -1.174176  -0.755488  -0.570481  -0.570481  -0.535976] <- HOMO
         LUMO->  [0.161274 0.161274 0.209418 0.881642 0.881642 0.911814]
time for xg, H, S2, Yg, Feff: 0.020
 E =   -108.78720720, delta E = -2.52651e-09, MaxD(dm) =   7.35e-07, RMSD(dm) = 7.17069e-08
**** Start Cycle 14 ****
time for NO, Ng: 0.024
time for Gg: 0.082
detC 1.0000000000000013
detNg [    1.002705     1.073637     1.480879     3.344183    15.115402   147.223908  2276.538679 11242.800176]
xg [0.997302 0.931414 0.675275 0.299027 0.066158 0.006792 0.000439 0.000089]
ciS 0.5395032230138168
ciH -65.6856227714938
Hsp + Hph =  -121.75204886553863
S2 = -0.000000
F(mod,ortho) updated with CDIIS
Alpha occ 7 vir 21; Beta occ 7 vir 21
Alpha energies:  [-15.582261  -1.174175  -0.755487  -0.570481  -0.570481  -0.535976] <- HOMO
         LUMO->  [0.161274 0.161274 0.209418 0.881642 0.881642 0.911814]
Beta energies:   [-15.582261  -1.174175  -0.755487  -0.570481  -0.570481  -0.535976] <- HOMO
         LUMO->  [0.161274 0.161274 0.209418 0.881642 0.881642 0.911814]
time for xg, H, S2, Yg, Feff: 0.021

***************
SUHF converged at cycle 14
Final E(SUHF) =   -108.78720720, delta E = -2.24532e-12, MaxD(dm) = 9.89554e-08, RMSD(dm) = 1.35265e-08
time for cyc: 1.774
******* suhf density *****
xgg [0.9973022022900723, 0.9314135674629448, 0.6752746440895142, 0.299026653720141, 0.06615768623749263, 0.006792375068427784, 0.0004392633470843941, 8.894581281555752e-05]
S, Sz 0.0 0.0
weight f0 [1. 1. 1. 1. 1. 1. 1. 1.]
CG00, CG01
Clebsch-Gordan coeff: < 0 0 0 0 | 0 0 > = 1 = 1.000000
Clebsch-Gordan coeff: < 0 0 1 0 | 0 0 > = 0 = 0.000000
Clebsch-Gordan coeff: < 0 0 2 0 | 0 0 > = 0 = 0.000000
xggint 1.0
time for 1pdm (and 2pdm): 1.311
SUHF NO occ alpha:  1.000000  1.000000  0.999210  0.998330  0.780596  0.597588  0.597588  0.402412  0.402412  0.219404  0.001670  0.000790  ...
SUHF NO occ beta:   1.000000  1.000000  0.999210  0.998330  0.780596  0.597588  0.597588  0.402412  0.402412  0.219404  0.001670  0.000790  ...
SUHF NO occ total:  2.000000  2.000000  1.998420  1.996661  1.561191  1.195175  1.195175  0.804825  0.804825  0.438809  0.003339  0.001580  ...
core 4, active 6, external 18
time for natorb: 0.001
deformed <S^2> = 2.7768935  2S+1 = 3.479594
***** End of SUHF *****
time tot: 3.170
Date: Fri Jan 21 22:12:46 2022

******** <class 'pyphf.supdft.PDFT'> ********
energy decomposition
E_suhf -108.787207
E_nuc 12.964842
E_core -173.703301
E_j 65.142663
E_k -12.122159
E_c -1.069251
Building tpbe functional
tot grids = 56520
    CPU time for untransformed density      0.19 sec, wall time      0.02 sec
    CPU time for otpd ao2mo      0.19 sec, wall time      0.02 sec
    CPU time for on-top pair density calculation      5.71 sec, wall time      4.15 sec
MC-PDFT: Total number of electrons in (this chunk of) the total density = 14.000000028026435
MC-PDFT: Total ms = (neleca - nelecb) / 2 in (this chunk of) the translated density = 2.726030794142684
    CPU time for on-top exchange-correlation energy calculation      0.05 sec, wall time      0.05 sec
 get_pd              , Wall:      4.253 s, CPU:      6.186 s, ratio   145.4%
E_ot -13.466375

******** <class 'pyphf.supdft.PDFT'> ********
energy decomposition
E_suhf -108.787207
E_nuc 12.964842
E_core -173.703301
E_j 65.142663
E_k -12.122159
E_c -1.069251
E_xcdft -13.491790
